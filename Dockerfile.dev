FROM ubuntu:22.04

LABEL maintainer="utsav.sen@stud.tu-darmstadt.de"

ENV DEBIAN_FRONTEND=noninteractive

# Toolchain, libs, and runtime deps
RUN apt-get update && apt-get install -y \
    build-essential cmake git gdb pkg-config \
    python3 python3-pip \
    libgtest-dev libgmock-dev \
    libsodium-dev libboost-all-dev libssl-dev \
    nlohmann-json3-dev \
 && rm -rf /var/lib/apt/lists/*

# Build and install GoogleTest/GoogleMock static libs (Ubuntu 22.04 path)
RUN cmake -S /usr/src/googletest -B /usr/src/googletest/build \
 && cmake --build /usr/src/googletest/build \
 && cp /usr/src/googletest/build/lib/*.a /usr/lib

# Ensure sqlparse for Python 3
RUN pip3 install --no-cache-dir sqlparse

WORKDIR /workspace/cloak_query

# Use local source
COPY . .

CMD ["bash"]